<!DOCTYPE html>
<html lang="en" class="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>OpalPixel - Worker Portal</title>
  <link rel="icon" type="image/png" href="{{ url_for('static', filename='uploads/Logo opalpixel_1.png') }}">
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@300;400;500;600;700;800;900&text=%E2%82%B5&display=swap" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" />
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: { sans: ['Inter', 'Noto Sans', 'sans-serif'] },
          colors: {
            accent: { DEFAULT: '#6366f1', light: '#818cf8', dark: '#4f46e5', 50: '#eef2ff' },
            surface: { light: '#ffffff', dark: '#0f1117', 'card-light': '#ffffff', 'card-dark': '#181a20' },
            sidebar: { light: '#fafafa', dark: '#13141a' },
          },
        },
      },
    };
  </script>
  <style>
    body { font-family: 'Inter', sans-serif; }
    .material-symbols-outlined { font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24; }
    .custom-scrollbar::-webkit-scrollbar { width: 4px; }
    .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
    .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.12); border-radius: 10px; }
    .dark .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.08); }
    .sidebar-wrap { transition: width 0.3s cubic-bezier(.4,0,.2,1), transform 0.3s cubic-bezier(.4,0,.2,1); }
    @media (max-width: 1023px) {
      .sidebar-wrap { position: fixed; z-index: 50; transform: translateX(-100%); }
      .sidebar-wrap.open { transform: translateX(0); }
    }
    @media (min-width: 1024px) {
      .sidebar-wrap.collapsed { width: 72px; }
      .sidebar-wrap.collapsed .nav-label, .sidebar-wrap.collapsed .sidebar-header-text, .sidebar-wrap.collapsed .sidebar-user-info, .sidebar-wrap.collapsed .sidebar-section-title { display: none; }
      .sidebar-wrap.collapsed .sidebar-logo { justify-content: center; }
      .sidebar-wrap.collapsed .nav-link { justify-content: center; padding-left: 0; padding-right: 0; }
      .sidebar-wrap.collapsed .sidebar-user { justify-content: center; }
    }
    .neon-glow { box-shadow: 0 0 20px rgba(99,102,241,0.15); }
    .dark .neon-glow { box-shadow: 0 0 25px rgba(99,102,241,0.3); }
    .nav-active { position: relative; }
    .nav-active::before { content:''; position:absolute; left:0; top:8px; bottom:8px; width:3px; background:#6366f1; border-radius:0 3px 3px 0; }
    html.transitioning, html.transitioning *, html.transitioning *::before, html.transitioning *::after {
      transition: background-color 0.3s, color 0.3s, border-color 0.3s, box-shadow 0.3s !important;
    }
  </style>
</head>
<body class="bg-neutral-50 dark:bg-surface-dark text-neutral-900 dark:text-neutral-100 min-h-screen flex overflow-hidden">
  <div id="sidebarOverlay" class="fixed inset-0 bg-black/30 dark:bg-black/50 backdrop-blur-sm z-40 hidden lg:hidden" onclick="toggleSidebar()"></div>

  <aside id="sidebar" class="sidebar-wrap w-[260px] bg-sidebar-light dark:bg-sidebar-dark border-r border-neutral-200/80 dark:border-white/5 flex flex-col h-screen shrink-0">
    <div class="h-16 px-5 flex items-center justify-between sidebar-logo">
      <div class="flex items-center gap-3">
        <img src="{{ url_for('static', filename='uploads/Logo opalpixel_1.png') }}" alt="OP" class="size-10 object-contain shrink-0 dark:brightness-0 dark:invert">
        <span class="sidebar-header-text text-[15px] font-bold tracking-tight text-neutral-800 dark:text-white">Worker Portal</span>
      </div>
      <button class="lg:hidden size-8 flex items-center justify-center rounded-lg hover:bg-neutral-200/60 dark:hover:bg-white/5 transition-colors text-neutral-500" onclick="toggleSidebar()">
        <span class="material-symbols-outlined text-xl">close</span>
      </button>
    </div>
    <div class="px-5 pt-5 pb-2 sidebar-section-title">
      <p class="text-[10px] font-semibold uppercase tracking-[0.15em] text-neutral-400 dark:text-neutral-500">Menu</p>
    </div>
    <nav class="flex-1 px-3 space-y-1 overflow-y-auto custom-scrollbar">
      <a class="nav-link flex items-center gap-3 px-3 py-2.5 rounded-lg text-[13px] font-medium transition-all {{ 'nav-active bg-accent/8 dark:bg-accent/10 text-accent dark:text-accent-light font-semibold' if request.endpoint == 'worker.dashboard' else 'text-neutral-600 dark:text-neutral-400 hover:bg-neutral-100 dark:hover:bg-white/5 hover:text-neutral-900 dark:hover:text-white' }}" href="{{ url_for('worker.dashboard') }}">
        <span class="material-symbols-outlined text-[20px]">grid_view</span><span class="nav-label">My Dashboard</span>
      </a>
      <a class="nav-link flex items-center gap-3 px-3 py-2.5 rounded-lg text-[13px] font-medium transition-all {{ 'nav-active bg-accent/8 dark:bg-accent/10 text-accent dark:text-accent-light font-semibold' if request.endpoint == 'invoices.create' else 'text-neutral-600 dark:text-neutral-400 hover:bg-neutral-100 dark:hover:bg-white/5 hover:text-neutral-900 dark:hover:text-white' }}" href="{{ url_for('invoices.create') }}">
        <span class="material-symbols-outlined text-[20px]">add_circle</span><span class="nav-label">Create Invoice</span>
      </a>
      <a class="nav-link flex items-center gap-3 px-3 py-2.5 rounded-lg text-[13px] font-medium transition-all {{ 'nav-active bg-accent/8 dark:bg-accent/10 text-accent dark:text-accent-light font-semibold' if request.endpoint == 'worker.my_invoices' else 'text-neutral-600 dark:text-neutral-400 hover:bg-neutral-100 dark:hover:bg-white/5 hover:text-neutral-900 dark:hover:text-white' }}" href="{{ url_for('worker.my_invoices') }}">
        <span class="material-symbols-outlined text-[20px]">description</span><span class="nav-label">My Invoices</span>
      </a>
      <a class="nav-link flex items-center gap-3 px-3 py-2.5 rounded-lg text-[13px] font-medium transition-all {{ 'nav-active bg-accent/8 dark:bg-accent/10 text-accent dark:text-accent-light font-semibold' if request.endpoint == 'worker.my_receipts' else 'text-neutral-600 dark:text-neutral-400 hover:bg-neutral-100 dark:hover:bg-white/5 hover:text-neutral-900 dark:hover:text-white' }}" href="{{ url_for('worker.my_receipts') }}">
        <span class="material-symbols-outlined text-[20px]">receipt_long</span><span class="nav-label">My Receipts</span>
      </a>
    </nav>
    <div class="p-4 border-t border-neutral-200/80 dark:border-white/5">
      <div class="sidebar-user flex items-center gap-3 mb-3">
        {% if user.image_path %}{% if user.image_path.startswith('http') %}<img src="{{ user.image_path }}" alt="Profile" class="size-9 rounded-full object-cover ring-2 ring-neutral-200 dark:ring-white/10">{% else %}<img src="{{ url_for('static', filename=user.image_path) }}" alt="Profile" class="size-9 rounded-full object-cover ring-2 ring-neutral-200 dark:ring-white/10">{% endif %}{% else %}
        <div class="size-9 rounded-full bg-accent/10 dark:bg-accent/20 ring-2 ring-neutral-200 dark:ring-white/10 flex items-center justify-center shrink-0">
          <span class="material-symbols-outlined text-accent text-lg">person</span>
        </div>{% endif %}
        <div class="sidebar-user-info flex-1 min-w-0">
          <p class="text-sm font-semibold truncate text-neutral-800 dark:text-white">{{ user.full_name }}</p>
          <p class="text-[11px] text-neutral-400 dark:text-neutral-500 font-medium truncate">{{ user.position or 'Worker' }}</p>
        </div>
      </div>
      <a href="{{ url_for('auth.logout') }}" class="w-full bg-neutral-100 dark:bg-white/5 text-neutral-600 dark:text-neutral-400 py-2 rounded-lg font-medium text-sm flex items-center justify-center gap-2 hover:bg-neutral-200 dark:hover:bg-white/10 transition-colors">
        <span class="material-symbols-outlined text-[18px]">logout</span>Sign Out
      </a>
    </div>
  </aside>

  <main class="flex-1 flex flex-col overflow-hidden h-screen">
    <header class="h-16 border-b border-neutral-200/80 dark:border-white/5 bg-white/80 dark:bg-surface-dark/80 backdrop-blur-xl px-4 sm:px-8 flex items-center justify-between z-10">
      <div class="flex items-center gap-3">
        <button class="lg:hidden size-9 flex items-center justify-center rounded-lg hover:bg-neutral-100 dark:hover:bg-white/5 transition-colors text-neutral-500" onclick="toggleSidebar()"><span class="material-symbols-outlined text-xl">menu</span></button>
        <button class="hidden lg:flex size-9 items-center justify-center rounded-lg hover:bg-neutral-100 dark:hover:bg-white/5 transition-colors text-neutral-400" onclick="collapseSidebar()" title="Toggle sidebar"><span class="material-symbols-outlined text-xl" id="collapseIcon">menu_open</span></button>
        <h2 class="text-lg font-bold dark:text-white">{% block page_title %}Dashboard{% endblock %}</h2>
      </div>
      <div class="flex items-center gap-2">
        <button onclick="toggleTheme()" class="size-9 rounded-lg flex items-center justify-center text-neutral-500 dark:text-neutral-400 hover:bg-neutral-100 dark:hover:bg-white/5 transition-colors" title="Toggle theme">
          <span class="material-symbols-outlined text-xl dark:hidden">dark_mode</span>
          <span class="material-symbols-outlined text-xl hidden dark:block">light_mode</span>
        </button>
        <span class="text-sm text-neutral-500 dark:text-neutral-400 hidden sm:inline">ID: <span class="font-mono font-bold text-neutral-800 dark:text-white">{{ user.worker_id }}</span></span>
      </div>
    </header>
    <div id="dashboardContent" class="flex-1 overflow-y-auto p-4 sm:p-8 custom-scrollbar bg-neutral-50 dark:bg-surface-dark">
      {% block content %}{% endblock %}
    </div>
  </main>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" crossorigin="anonymous"></script>
  <script>
    function getTheme() { return localStorage.getItem('opalpixel-theme') || 'light'; }
    function applyTheme(t) { const h=document.documentElement; h.classList.add('transitioning'); h.classList.toggle('dark',t==='dark'); h.classList.toggle('light',t!=='dark'); localStorage.setItem('opalpixel-theme',t); setTimeout(()=>h.classList.remove('transitioning'),350); }
    function toggleTheme() { applyTheme(getTheme()==='dark'?'light':'dark'); }
    (function(){ if(localStorage.getItem('opalpixel-theme')==='dark'){document.documentElement.classList.add('dark');document.documentElement.classList.remove('light');} })();
    function toggleSidebar() { const s=document.getElementById('sidebar'),o=document.getElementById('sidebarOverlay'); s.classList.toggle('open'); o.classList.toggle('hidden'); document.body.classList.toggle('overflow-hidden',s.classList.contains('open')); }
    function collapseSidebar() { const s=document.getElementById('sidebar'),i=document.getElementById('collapseIcon'); s.classList.toggle('collapsed'); i.textContent=s.classList.contains('collapsed')?'menu':'menu_open'; localStorage.setItem('opalpixel-sidebar',s.classList.contains('collapsed')?'collapsed':'expanded'); }
    (function(){ if(localStorage.getItem('opalpixel-sidebar')==='collapsed'){const s=document.getElementById('sidebar'),i=document.getElementById('collapseIcon');if(s)s.classList.add('collapsed');if(i)i.textContent='menu';} })();
  </script>
</body>
</html>